<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Pixel Pomodoro Readable</title>
    <link href="https://fonts.googleapis.com/css2?family=Silkscreen&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0f1115;       
            --border-color: #3b4261;   
            --accent-color: #82aaff;   
            --break-color: #c3e88d;    
            --text-color: #dbe6f5;     
            --off-color: #1a1e29;      
            --overlay-bg: rgba(15, 17, 21, 0.95);
        }

        :root.light {
            --bg-color: #f8f9fb;
            --border-color: #2d3748;
            --accent-color: #3b6ed5;
            --break-color: #4caf50;
            --text-color: #1a1a2e;
            --off-color: #ebedf2;
            --overlay-bg: rgba(248, 249, 251, 0.95);
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            font-family: 'Silkscreen', cursive;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            color: var(--text-color);
            user-select: none;
        }

        .timer-container {
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            border: 2px solid var(--border-color);
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
        }

        /* --- 헤더 수정됨 --- */
        .header-bar {
            height: 30px; /* 높이 약간 증가 */
            border-bottom: 2px solid var(--border-color);
            background: var(--off-color); /* 배경을 약간 밝게 */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px; /* 폰트 크기 증가 */
            color: var(--accent-color); /* 가독성 좋은 포인트 컬러 */
            text-shadow: 0 0 5px rgba(130, 170, 255, 0.5); /* 네온 글로우 효과 */
            flex-shrink: 0;
            letter-spacing: 3px; /* 자간 넓힘 */
            font-weight: bold;
        }
        
        /* 휴식 모드일 때 헤더 색상도 변경 */
        .break-mode .header-bar {
            color: var(--break-color);
            text-shadow: 0 0 5px rgba(195, 232, 141, 0.5);
        }

        /* 메인 영역 */
        .content {
            padding: 0 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            position: relative;
        }

        .status-badge {
            font-size: 10px; 
            margin-bottom: 10px; 
            padding: 2px 6px;
            border: 1px solid var(--border-color);
            color: var(--text-color);
            border-radius: 2px;
            opacity: 0.8;
        }

        .timer-display {
            font-size: 18vw;
            color: var(--accent-color);
            text-shadow: 0 0 10px rgba(130, 170, 255, 0.3);
            margin-bottom: 15px;
            line-height: 1;
            transition: color 0.3s, text-shadow 0.3s;
        }

        .break-mode .timer-display {
            color: var(--break-color);
            text-shadow: 0 0 10px rgba(195, 232, 141, 0.3);
        }
        .break-mode .block.active { 
            background: var(--break-color); 
            box-shadow: 0 0 5px var(--break-color);
        }
        /* 휴식 모드일 때 설정 아이콘 색상 변경 */
        .break-mode .settings-icon svg {
            fill: var(--break-color);
        }

        @media (min-width: 400px) {
            .timer-display { font-size: 80px; }
        }

        /* 픽셀 진행 바 */
        .progress-bar {
            display: flex;
            gap: 4px;
            width: 200px;
            max-width: 90%;
            height: 12px;
            margin-bottom: 25px;
        }
        .block {
            flex: 1;
            height: 100%;
            background: var(--off-color);
            border-radius: 1px;
            transition: background 0.2s;
        }
        .block.active {
            background: var(--accent-color);
            box-shadow: 0 0 5px var(--accent-color);
        }

        /* 설정 아이콘 (화면 중앙 하단) */
        .settings-icon {
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.2s, transform 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }
        .settings-icon:hover {
            opacity: 1;
            transform: rotate(90deg);
        }
        .settings-icon svg {
            width: 24px;
            height: 24px;
            fill: var(--accent-color);
            shape-rendering: crispEdges;
            transition: fill 0.3s;
        }

        /* 컨트롤 버튼 */
        .controls {
            display: flex;
            border-top: 2px solid var(--border-color);
            height: 45px;
            flex-shrink: 0;
        }
        button {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-color);
            font-family: 'Silkscreen';
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        button:not(:last-child) { border-right: 2px solid var(--border-color); }
        button:hover {
            background: rgba(130, 170, 255, 0.1);
            color: var(--accent-color);
        }
        button:active { background: rgba(130, 170, 255, 0.2); }

        /* 설정 오버레이 */
        #settings-modal {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--overlay-bg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            display: none;
        }
        #settings-modal.show { display: flex; }

        .settings-box {
            border: 2px solid var(--border-color);
            background: var(--bg-color);
            padding: 20px;
            width: 80%;
            max-width: 300px;
            text-align: center;
            box-shadow: 4px 4px 0px var(--off-color);
        }
        
        .setting-row {
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
        }
        
        input[type="number"] {
            background: var(--off-color);
            border: 1px solid var(--border-color);
            color: var(--accent-color);
            font-family: 'Silkscreen';
            width: 60px;
            padding: 5px;
            text-align: center;
            font-size: 14px;
        }
        input[type="number"]:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .save-btn {
            background: var(--accent-color);
            color: var(--bg-color);
            border: none;
            padding: 10px 15px;
            font-family: 'Silkscreen';
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
            font-size: 14px;
        }
        .save-btn:hover { opacity: 0.8; }

    </style>
</head>
<body>

    <div class="timer-container" id="main-container">
        <div class="header-bar">
            <span>::: PIXEL FOCUS :::</span>
        </div>

        <div class="content">
            <div class="status-badge" id="status-text">FOCUS MODE</div>
            <div class="timer-display" id="time">25:00</div>
            
            <div class="progress-bar">
                <div class="block active"></div><div class="block active"></div>
                <div class="block active"></div><div class="block active"></div>
                <div class="block active"></div><div class="block active"></div>
                <div class="block active"></div><div class="block active"></div>
                <div class="block active"></div><div class="block active"></div>
            </div>

            <div class="settings-icon" onclick="openSettings()" title="Settings">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 2h4v2h2v2h2v2h2v4h-2v2h-2v2h-2v2h-4v-2h-2v-2h-2v-2h-2v-4h2v-2h2v-2h2v-2h2z M12 8a4 4 0 1 0 0 8 4 4 0 0 0 0-8z"/>
                </svg>
            </div>
        </div>

        <div class="controls">
            <button onclick="toggleTimer()" id="btn-main">START</button>
            <button onclick="skipTimer()">SKIP</button>
            <button onclick="resetTimer()">RESET</button>
        </div>
    </div>

    <div id="settings-modal">
        <div class="settings-box">
            <h3 style="margin-top:0; color:var(--accent-color);">SETTINGS</h3>
            
            <div class="setting-row">
                <label>FOCUS (MIN)</label>
                <input type="number" id="set-focus" value="25" min="1" max="60">
            </div>
            
            <div class="setting-row">
                <label>BREAK (MIN)</label>
                <input type="number" id="set-break" value="5" min="1" max="30">
            </div>

            <button class="save-btn" onclick="saveSettings()">SAVE & RESET</button>
        </div>
    </div>

    <script>
        // 노션 테마 감지
        const params = new URLSearchParams(window.location.search);
        if (params.get("mode") === "light") {
            document.documentElement.classList.add("light");
        }

        let focusTimeSet = 25;
        let breakTimeSet = 5;
        let timeLeft = focusTimeSet * 60;
        let maxTime = focusTimeSet * 60;
        let timerId = null;
        let isRunning = false;
        let isBreak = false;

        const timeDisplay = document.getElementById("time");
        const btnMain = document.getElementById("btn-main");
        const blocks = document.querySelectorAll(".block");
        const container = document.getElementById("main-container");
        const statusText = document.getElementById("status-text");
        const modal = document.getElementById("settings-modal");
        const inputFocus = document.getElementById("set-focus");
        const inputBreak = document.getElementById("set-break");

        // 8비트 사운드
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx = new AudioContext();

        function play8BitAlarm() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.type = 'square';
            
            oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime); 
            oscillator.frequency.setValueAtTime(659.25, audioCtx.currentTime + 0.1); 
            oscillator.frequency.setValueAtTime(783.99, audioCtx.currentTime + 0.2); 
            oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime + 0.4); 

            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.6);

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.6);
        }

        function updateDisplay() {
            const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
            const s = (timeLeft % 60).toString().padStart(2, '0');
            timeDisplay.innerText = `${m}:${s}`;

            const percent = timeLeft / maxTime;
            const activeCount = Math.ceil(percent * 10);
            
            blocks.forEach((block, idx) => {
                if (idx < activeCount) block.classList.add("active");
                else block.classList.remove("active");
            });
        }

        function switchMode() {
            isBreak = !isBreak;
            if (isBreak) {
                maxTime = breakTimeSet * 60;
                timeLeft = maxTime;
                statusText.innerText = "BREAK TIME";
                container.classList.add("break-mode");
            } else {
                maxTime = focusTimeSet * 60;
                timeLeft = maxTime;
                statusText.innerText = "FOCUS MODE";
                container.classList.remove("break-mode");
            }
            updateDisplay();
        }

        function toggleTimer() {
            if (audioCtx.state === 'suspended') audioCtx.resume();

            if (isRunning) {
                clearInterval(timerId);
                isRunning = false;
                btnMain.innerText = "START";
                btnMain.style.color = "";
            } else {
                isRunning = true;
                btnMain.innerText = "PAUSE";
                btnMain.style.color = isBreak ? "var(--break-color)" : "var(--accent-color)";
                
                timerId = setInterval(() => {
                    if (timeLeft > 0) {
                        timeLeft--;
                        updateDisplay();
                    } else {
                        clearInterval(timerId);
                        isRunning = false;
                        btnMain.innerText = "START";
                        play8BitAlarm();
                        switchMode();
                    }
                }, 1000);
            }
        }

        function resetTimer() {
            clearInterval(timerId);
            isRunning = false;
            maxTime = (isBreak ? breakTimeSet : focusTimeSet) * 60;
            timeLeft = maxTime;
            updateDisplay();
            btnMain.innerText = "START";
            btnMain.style.color = "";
        }

        function skipTimer() {
            clearInterval(timerId);
            isRunning = false;
            btnMain.innerText = "START";
            switchMode();
        }

        function openSettings() {
            inputFocus.value = focusTimeSet;
            inputBreak.value = breakTimeSet;
            modal.classList.add("show");
        }

        function saveSettings() {
            const newFocus = parseInt(inputFocus.value);
            const newBreak = parseInt(inputBreak.value);
            if(newFocus > 0) focusTimeSet = newFocus;
            if(newBreak > 0) breakTimeSet = newBreak;
            modal.classList.remove("show");
            isBreak = false; 
            container.classList.remove("break-mode");
            statusText.innerText = "FOCUS MODE";
            resetTimer(); 
        }

        updateDisplay();
    </script>
</body>
</html>
